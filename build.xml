<?xml version="1.0"?>

<!--
  Bandika! - A Java based Content Management System
  Copyright (C) 2009 Michael RÃ¶nnau

  This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 3 of the License, or (at your option) any later version.
  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
  You should have received a copy of the GNU General Public License along with this program; if not, see <http://www.gnu.org/licenses/>.

  Code format: This code uses 2 blanks per indent!
-->

<project name="bandika" default="deploy" basedir=".">

  <property environment="env"/>
  <property name="srcdir" value="${basedir}/src"/>
  <property name="classdir" value="${basedir}/classes"/>
  <property name="resourcedir" value="${basedir}/resources"/>
  <property name="fckdir" value="${basedir}/../../fckeditor-2.5.1"/>
  <property name="libdir" value="${basedir}/lib"/>
  <property name="configdir" value="${basedir}/config"/>
  <property name="webinfdir" value="${basedir}/WEB-INF"/>
  <property name="builddir" value="${basedir}/build"/>
  <property name="tomcat.dir" value="${env.TOMCAT_HOME}"/>
  <property name="rootfiles.dir" value="${basedir}/../../bandikaroot"/>
  <property name="javadocdir" value="${basedir}/../../javadoc"/>

  <property name="appname" value="bandika"/>

  <!-- Build classpath -->
  <path id="classpath">
    <pathelement location="${classdir}"/>
  </path>

  <path id="build.classpath">
    <pathelement location="${classdir}"/>
    <pathelement location="${libdir}/mail.jar"/>
    <pathelement location="${libdir}/commons-fileupload.jar"/>
    <pathelement location="${tomcat.dir}/common/lib/servlet-api.jar"/>
    <pathelement location="${tomcat.dir}/common/lib/jsp-api.jar"/>
  </path>

  <target name="prepare">
    <mkdir dir="${classdir}"/>
    <mkdir dir="${builddir}"/>
  </target>

  <target name="clean">
    <delete dir="${builddir}"/>
    <delete dir="${classdir}"/>
    <delete file="${basedir}/${appname}.jar"/>
  </target>

  <target name="compile" depends="prepare">
    <javac srcdir="${srcdir}"
           destdir="${classdir}"
           debug="on"
           deprecation="on"
           optimize="off"
           includes="**">
      <classpath refid="build.classpath"/>
    </javac>
  </target>

  <target name="copyfiles" depends="compile">
    <mkdir dir="${builddir}/WEB-INF"/>
    <mkdir dir="${builddir}/WEB-INF/classes"/>
    <mkdir dir="${builddir}/WEB-INF/lib"/>
    <copy todir="${builddir}/WEB-INF/classes">
      <fileset dir="${classdir}"/>
    </copy>
    <copy todir="${builddir}/WEB-INF/lib">
      <fileset dir="${libdir}">
        <exclude name="mysql*.*"/>
      </fileset>
    </copy>
    <copy todir="${builddir}/WEB-INF/classes">
      <fileset dir="${srcdir}">
        <include name="*.properties"/>
      </fileset>
    </copy>
    <copy todir="${builddir}">
      <fileset dir="${resourcedir}">
        <include name="jsps/**/*.*"/>
        <include name="templates/**/*.*"/>
        <include name="index.html"/>
      </fileset>
    </copy>
  </target>

  <target name="copyrootfiles" depends="compile">
    <mkdir dir="${builddir}/fckeditor"/>
    <copy todir="${builddir}">
      <fileset dir="${resourcedir}">
        <include name="img/*.*"/>
        <include name="css/*.*"/>
        <include name="jscript/*.*"/>
        <include name="index.html"/>
      </fileset>
    </copy>
    <copy todir="${builddir}/fckeditor">
      <fileset dir="${fckdir}">
        <exclude name="**/fckconfig.js"/>
      </fileset>
      <fileset dir="${configdir}">
        <include name="fckconfig.js"/>
      </fileset>
    </copy>
  </target>

  <target name="makeapp" depends="copyfiles">
    <delete file="${basedir}/${appname}.war"/>
    <war warfile="${basedir}/${appname}.war" webxml="${webinfdir}/web.xml">
      <fileset dir="${builddir}">
        <include name="**/*.*"/>
      </fileset>
    </war>
  </target>

  <target name="makefullapp" depends="copyfiles,copyrootfiles">
    <delete file="${basedir}/${appname}.war"/>
    <war warfile="${basedir}/${appname}.war" webxml="${webinfdir}/web.xml">
      <fileset dir="${builddir}">
        <include name="**/*.*"/>
      </fileset>
    </war>
  </target>

  <target name="deploy" depends="makeapp">
    <copy file="${basedir}/${appname}.war" todir="${tomcat.dir}/webapps"/>
  </target>

  <target name="deployfull" depends="makefullapp">
    <copy file="${basedir}/${appname}.war" todir="${tomcat.dir}/webapps"/>
  </target>

  <target name="cleanroot">
    <delete dir="${rootfiles.dir}"/>
  </target>

  <target name="deployroot" depends="compile">
    <mkdir dir="${rootfiles.dir}"/>
    <mkdir dir="${rootfiles.dir}/fckeditor"/>
    <copy todir="${rootfiles.dir}">
      <fileset dir="${resourcedir}">
        <include name="img/*.*"/>
        <include name="css/*.*"/>
        <include name="jscript/*.*"/>
        <include name="index.html"/>
      </fileset>
    </copy>
    <copy todir="${rootfiles.dir}/fckeditor">
      <fileset dir="${fckdir}">
        <exclude name="**/fckconfig.js"/>
      </fileset>
      <fileset dir="${configdir}">
        <include name="fckconfig.js"/>
      </fileset>
    </copy>
  </target>

  <target name="javadoc">
    <mkdir dir="${javadocdir}"/>
    <javadoc
        destdir="${javadocdir}"
        author="true"
        version="true"
        use="true"
        windowtitle="Bandika! API">
      <classpath refid="build.classpath"/>

      <fileset dir="src" defaultexcludes="yes">
        <include name="de/net25/**"/>
      </fileset>

      <doctitle><![CDATA[<h1>Bandika!</h1>]]></doctitle>
      <bottom><![CDATA[<i>Copyright &#169; 2009 Michael Roennau All Rights Reserved.</i>]]></bottom>
      <tag name="todo" scope="all" description="To do:"/>
      <group title="Base" packages="de.net25.base.*"/>
      <group title="Content" packages="de.net25.content.*"/>
      <group title="Servlets and related data" packages="de.net25.http.*"/>
      <group title="Resources and Statics" packages="de.net25.resources.*"/>
      <group title="User and Groups" packages="de.net25.user.*"/>
      <link offline="true" href="http://java.sun.com/j2se/1.5.0/docs/api/" packagelistLoc="C:\tmp"/>
    </javadoc>
  </target>

</project>

