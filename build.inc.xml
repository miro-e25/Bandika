<project name="bandika.inc" basedir=".">

  <target name="init">
    <tstamp/>
    <property name="version" value="1.00"/>
    <property name="year" value="2013"/>
    <property environment="env"/>
    <property name="debug" value="on"/>
    <property name="optimize" value="off"/>
    <property name="deprecation" value="on"/>
    <property name="baselib.dir" value="./weblib"/>
    <property name="buildbase.dir" value="../build"/>
    <property name="modules.dir" value="../modules"/>
    <property name="tomcat.dir" value="c:\server\tomcat"/>
    <property name="module_name" value=""/>
  </target>

  <target name="prepare" depends="init">
    <mkdir dir="${buildbase.dir}"/>
    <mkdir dir="${modules.dir}"/>
  </target>

  <target name="init_module" depends="init">
    <echo message="----------- bandika ${module_name} ${version} [${year}] ------------"/>
    <property name="src.dir" value="./${module_name}/src"/>
    <property name="web.dir" value="./${module_name}/web"/>
    <property name="lib.dir" value="./${module_name}/lib"/>
    <property name="sql.dir" value="./${module_name}/sql"/>
    <property name="build.dir" value="${buildbase.dir}/${module_name}"/>
    <path id="javac-classpath">
      <fileset dir="${baselib.dir}">
        <include name="*.jar" />
      </fileset>
      <fileset dir="${lib.dir}">
        <include name="*.jar"/>
      </fileset>
      <pathelement location="${buildbase.dir}/base/WEB-INF/classes"/>
      <pathelement location="${buildbase.dir}/cms/WEB-INF/classes"/>
    </path>
  </target>

  <target name="clean_module" depends="init_module">
    <delete dir="${build.dir}"/>
  </target>

  <target name="prepare_module" depends="init_module">
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${build.dir}/sql"/>
    <mkdir dir="${build.dir}/META-INF"/>
    <mkdir dir="${build.dir}/WEB-INF"/>
    <mkdir dir="${build.dir}/WEB-INF/classes"/>
    <mkdir dir="${build.dir}/WEB-INF/lib"/>
  </target>

  <target name="compile" depends="prepare_module">
    <javac source="1.6"
           target="1.6"
           srcdir="${src.dir}"
           destdir="${build.dir}/WEB-INF/classes"
           debug="${debug}"
           optimize="${optimize}">
      <classpath refid="javac-classpath" />
    </javac>
  </target>

  <target name="copyfiles" depends="prepare_module">
    <copy todir="${build.dir}/sql">
      <fileset dir="${sql.dir}">
        <include name="*.*"/>
      </fileset>
    </copy>
    <copy todir="${build.dir}">
      <fileset dir="${web.dir}">
        <exclude name="*.svn*"/>
        <exclude name="**/web.xml"/>
      </fileset>
    </copy>
    <copy todir="${build.dir}/WEB-INF/classes">
      <fileset dir="${src.dir}">
        <include name="*.properties"/>
      </fileset>
    </copy>
    <copy todir="${build.dir}/WEB-INF/lib">
      <fileset dir="${lib.dir}">
        <include name="*.jar"/>
      </fileset>
    </copy>
  </target>

  <target name="makezip" depends="compile,copyfiles">
    <delete file="${modules.dir}/${module_name}.zip"/>
    <zip file="${modules.dir}/${module_name}.zip">
      <fileset dir="${build.dir}">
        <include name="**/*.*"/>
        <exclude name="_statics/ckeditor/**/*.*"/>
      </fileset>
    </zip>
  </target>

  <target name="makewar" depends="compile,copyfiles">
    <delete file="${modules.dir}/ROOT.war"/>
    <war warfile="${modules.dir}/ROOT.war" webxml="${web.dir}/WEB-INF/web.xml">
      <fileset dir="${build.dir}">
        <include name="**/*.*"/>
      </fileset>
    </war>
  </target>

  <target name="deploy" depends="makewar">
    <copy todir="${tomcat.dir}/bandika">
      <fileset file="${modules.dir}/ROOT.war"/>
    </copy>
  </target>

  <target name="update" depends="compile,copyfiles">
    <copy todir="${tomcat.dir}/bandika/ROOT">
      <fileset dir="${build.dir}">
        <include name="**/*.*"/>
        <exclude name="**/web.xml"/>
      </fileset>
    </copy>
  </target>

</project>
